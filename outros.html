// Dados iniciais (simulando um "banco de dados")
let clientes = [
  {
    id: 1,
    nome: "João Silva",
    cpf: "123.456.789-00",
    telefone: "(11) 99999-9999",
    email: "joao@provedor.com",
    plano: "200mb",
    status: "ativo"
  },
  {
    id: 2,
    nome: "Maria Souza",
    cpf: "987.654.321-00",
    telefone: "(11) 98888-8888",
    email: "maria@provedor.com",
    plano: "300mb",
    status: "ativo"
  }
];

// Função para renderizar a lista de clientes
function renderClientes() {
  const lista = document.getElementById('clientes-lista');
  lista.innerHTML = '';

  clientes.forEach(cliente => {
    const statusClass = cliente.status === 'ativo' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
    const planoText = {
      '100mb': '100 Mbps',
      '200mb': '200 Mbps',
      '300mb': '300 Mbps'
    }[cliente.plano];

    lista.innerHTML += `
      <tr>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="font-medium">${cliente.nome}</div>
          <div class="text-sm text-gray-500">${cliente.cpf}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div>${cliente.telefone}</div>
          <div class="text-sm text-gray-500">${cliente.email}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="font-medium">${planoText}</span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="px-2 py-1 text-xs rounded-full ${statusClass}">
            ${cliente.status === 'ativo' ? 'Ativo' : 'Pendente'}
          </span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <button onclick="editarCliente(${cliente.id})" class="text-blue-500 hover:text-blue-700 mr-3">
            <i class="fas fa-edit"></i>
          </button>
          <button onclick="excluirCliente(${cliente.id})" class="text-red-500 hover:text-red-700">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    `;
  });
}

// Função para mostrar/ocultar formulário
function toggleClientForm(editando = false) {
  const form = document.getElementById('client-form');
  const btn = document.getElementById('new-client-btn');
  
  form.classList.toggle('hidden');
  
  if (form.classList.contains('hidden')) {
    btn.innerHTML = '<i class="fas fa-plus mr-2"></i>Novo Cliente';
    document.getElementById('cadastro-cliente-form').reset();
  } else {
    btn.innerHTML = '<i class="fas fa-times mr-2"></i>Cancelar';
  }
}

// Função para salvar cliente (novo ou edição)
document.getElementById('cadastro-cliente-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const cliente = {
    id: document.getElementById('cliente-id')?.value || clientes.length + 1,
    nome: document.getElementById('cliente-nome').value,
    cpf: document.getElementById('cliente-cpf').value,
    telefone: document.getElementById('cliente-telefone').value,
    email: document.getElementById('cliente-email').value,
    plano: document.getElementById('cliente-plano').value,
    status: 'ativo'
  };

  // Verifica se é edição
  const index = clientes.findIndex(c => c.id == cliente.id);
  if (index >= 0) {
    clientes[index] = cliente;
  } else {
    clientes.push(cliente);
  }

  renderClientes();
  toggleClientForm();
  showAlert('Cliente salvo com sucesso!', 'success');
});

// Funções auxiliares
function editarCliente(id) {
  const cliente = clientes.find(c => c.id == id);
  if (!cliente) return;

  document.getElementById('cliente-nome').value = cliente.nome;
  document.getElementById('cliente-cpf').value = cliente.cpf;
  document.getElementById('cliente-telefone').value = cliente.telefone;
  document.getElementById('cliente-email').value = cliente.email;
  document.getElementById('cliente-plano').value = cliente.plano;

  // Cria um campo hidden para o ID se não existir
  if (!document.getElementById('cliente-id')) {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.id = 'cliente-id';
    input.value = cliente.id;
    document.getElementById('cadastro-cliente-form').appendChild(input);
  } else {
    document.getElementById('cliente-id').value = cliente.id;
  }

  toggleClientForm(true);
}

function excluirCliente(id) {
  if (confirm('Tem certeza que deseja excluir este cliente?')) {
    clientes = clientes.filter(c => c.id != id);
    renderClientes();
    showAlert('Cliente excluído com sucesso!', 'success');
  }
}

function showAlert(message, type = 'success') {
  const alert = document.createElement('div');
  alert.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white ${
    type === 'success' ? 'bg-green-500' : 'bg-red-500'
  }`;
  alert.textContent = message;
  document.body.appendChild(alert);
  
  setTimeout(() => {
    alert.remove();
  }, 3000);
}

// Inicialização
document.addEventListener("DOMContentLoaded", function() {
  showSection('dashboard');
  renderClientes();
});